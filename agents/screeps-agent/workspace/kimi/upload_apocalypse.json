{"branch":"default","modules":{"main":"// üèÜ SCREEPS ULTIMATE PvP DOMINATION AI v4.0 üèÜ\n// APOCALYPSE EDITION - Total Annihilation Protocol\n\nconst DEFENSE_MODE = {\n    PEACETIME: 0,\n    ALERT: 1,\n    WAR: 2,\n    EMERGENCY: 3,\n    TOTAL_WAR: 4,\n    APOCALYPSE: 5\n};\n\nlet gameState = {\n    defenseMode: DEFENSE_MODE.PEACETIME,\n    lastEnemySeen: 0,\n    currentTick: 0,\n    roomName: 'W1N3',\n    spawnPos: {x: 25, y: 25},\n    enemies: [],\n    allies: [],\n    enemyRooms: new Set(),\n    attackTargets: [],\n    lastAttackTime: 0,\n    attackWaveSize: 0,\n    maxAttackWave: 8,\n    economyPhase: 'early',\n    militaryPhase: 'defensive',\n    totalWarDeclared: false\n};\n\n// APOCALYPSE military unit designs - Maximum destruction, no mercy\nconst militaryBodies = {\n    scout: [MOVE, MOVE, MOVE, MOVE, MOVE, MOVE], // Ultra fast recon\n    \n    warrior: [TOUGH, TOUGH, TOUGH, TOUGH, ATTACK, ATTACK, ATTACK, ATTACK, ATTACK, MOVE, MOVE, MOVE, MOVE, MOVE, MOVE],\n    \n    archer: [TOUGH, TOUGH, TOUGH, RANGED_ATTACK, RANGED_ATTACK, RANGED_ATTACK, RANGED_ATTACK, RANGED_ATTACK, MOVE, MOVE, MOVE, MOVE, MOVE],\n    \n    healer: [TOUGH, TOUGH, HEAL, HEAL, HEAL, HEAL, HEAL, MOVE, MOVE, MOVE, MOVE, MOVE],\n    \n    destroyer: [TOUGH, TOUGH, TOUGH, TOUGH, TOUGH, TOUGH, ATTACK, ATTACK, ATTACK, ATTACK, ATTACK, ATTACK, ATTACK, ATTACK, MOVE, MOVE, MOVE, MOVE, MOVE, MOVE, MOVE],\n    \n    siege: [TOUGH, TOUGH, TOUGH, TOUGH, RANGED_ATTACK, RANGED_ATTACK, RANGED_ATTACK, RANGED_ATTACK, RANGED_ATTACK, RANGED_ATTACK, MOVE, MOVE, MOVE, MOVE, MOVE, MOVE],\n    \n    assassin: [MOVE, MOVE, MOVE, MOVE, MOVE, ATTACK, ATTACK, ATTACK, ATTACK, ATTACK, ATTACK], // Lightning fast executioner\n    \n    kamikaze: [MOVE, MOVE, MOVE, MOVE, MOVE, ATTACK, ATTACK, ATTACK, ATTACK, ATTACK, ATTACK, ATTACK, ATTACK], // Pure annihilation\n    \n    apocalypse: [TOUGH, TOUGH, TOUGH, TOUGH, TOUGH, ATTACK, ATTACK, ATTACK, ATTACK, RANGED_ATTACK, RANGED_ATTACK, RANGED_ATTACK, HEAL, MOVE, MOVE, MOVE, MOVE, MOVE, MOVE, MOVE, MOVE, MOVE, MOVE, MOVE, MOVE] // Ultimate war machine\n};\n\n// APOCALYPSE role system - Total domination\nconst roles = {\n    harvester: {\n        body: [WORK, WORK, WORK, WORK, WORK, CARRY, CARRY, MOVE, MOVE],\n        maxCount: 10,\n        priority: 1,\n        emergencyCount: 4\n    },\n    \n    upgrader: {\n        body: [WORK, WORK, WORK, WORK, WORK, CARRY, CARRY, MOVE, MOVE],\n        maxCount: 8,\n        priority: 2,\n        emergencyCount: 3\n    },\n    \n    builder: {\n        body: [WORK, WORK, WORK, CARRY, CARRY, CARRY, MOVE, MOVE],\n        maxCount: 6,\n        priority: 3,\n        emergencyCount: 2\n    },\n    \n    repairer: {\n        body: [WORK, WORK, CARRY, CARRY, MOVE, MOVE],\n        maxCount: 4,\n        priority: 4,\n        emergencyCount: 1\n    },\n    \n    scout: {\n        body: militaryBodies.scout,\n        maxCount: 4,\n        priority: 5,\n        emergencyCount: 2\n    },\n    \n    warrior: {\n        body: militaryBodies.warrior,\n        maxCount: 6,\n        priority: 6,\n        emergencyCount: 3\n    },\n    \n    archer: {\n        body: militaryBodies.archer,\n        maxCount: 6,\n        priority: 7,\n        emergencyCount: 3\n    },\n    \n    healer: {\n        body: militaryBodies.healer,\n        maxCount: 4,\n        priority: 8,\n        emergencyCount: 2\n    },\n    \n    attacker: {\n        body: militaryBodies.destroyer,\n        maxCount: 8,\n        priority: 9,\n        emergencyCount: 4\n    },\n    \n    kamikaze: {\n        body: militaryBodies.kamikaze,\n        maxCount: 6,\n        priority: 10,\n        emergencyCount: 3\n    },\n    \n    apocalypse: {\n        body: militaryBodies.apocalypse,\n        maxCount: 4,\n        priority: 11,\n        emergencyCount: 2\n    }\n};\n\n// APOCALYPSE defense system - Impregnable fortress of doom\nconst defense = {\n    buildFortress: function(room) {\n        const spawn = Game.spawns.Spawn1;\n        if (!spawn) return;\n        \n        // Build MASSIVE fortress walls\n        const wallPositions = [];\n        for (let radius = 3; radius <= 6; radius++) {\n            for (let x = spawn.pos.x - radius; x <= spawn.pos.x + radius; x++) {\n                for (let y = spawn.pos.y - radius; y <= spawn.pos.y + radius; y++) {\n                    if (Math.abs(x - spawn.pos.x) === radius || Math.abs(y - spawn.pos.y) === radius) {\n                        wallPositions.push({x, y});\n                    }\n                }\n            }\n        }\n        \n        wallPositions.forEach(pos => {\n            const structures = room.lookForAt(LOOK_STRUCTURES, pos.x, pos.y);\n            const hasWall = structures.some(s => s.structureType === STRUCTURE_WALL || s.structureType === STRUCTURE_RAMPART);\n            \n            if (!hasWall) {\n                if (room.createConstructionSite(pos.x, pos.y, STRUCTURE_RAMPART) === OK) {\n                    console.log(`üè∞ APOCALYPSE Fortress rampart at ${pos.x},${pos.y}`);\n                }\n            }\n        });\n    },\n    \n    buildTowers: function(room) {\n        const towerCount = room.find(FIND_MY_STRUCTURES, {\n            filter: { structureType: STRUCTURE_TOWER }\n        }).length;\n        \n        if (towerCount < 6) {\n            const towerPositions = [\n                {x: gameState.spawnPos.x - 6, y: gameState.spawnPos.y - 6},\n                {x: gameState.spawnPos.x + 6, y: gameState.spawnPos.y - 6},\n                {x: gameState.spawnPos.x - 6, y: gameState.spawnPos.y + 6},\n                {x: gameState.spawnPos.x + 6, y: gameState.spawnPos.y + 6},\n                {x: gameState.spawnPos.x, y: gameState.spawnPos.y - 8},\n                {x: gameState.spawnPos.x, y: gameState.spawnPos.y + 8}\n            ];\n            \n            towerPositions.forEach(pos => {\n                if (room.createConstructionSite(pos.x, pos.y, STRUCTURE_TOWER) === OK) {\n                    console.log(`üèóÔ∏è APOCALYPSE Tower construction at ${pos.x},${pos.y}`);\n                }\n            });\n        }\n    },\n    \n    buildExtensions: function(room) {\n        const extensionCount = room.find(FIND_MY_STRUCTURES, {\n            filter: { structureType: STRUCTURE_EXTENSION }\n        }).length;\n        \n        if (extensionCount < 60) {\n            const positions = [];\n            for (let x = gameState.spawnPos.x - 12; x <= gameState.spawnPos.x + 12; x++) {\n                for (let y = gameState.spawnPos.y - 12; y <= gameState.spawnPos.y + 12; y++) {\n                    if (Math.abs(x - gameState.spawnPos.x) + Math.abs(y - gameState.spawnPos.y) > 5) {\n                        positions.push({x, y});\n                    }\n                }\n            }\n            \n            positions.forEach(pos => {\n                if (room.createConstructionSite(pos.x, pos.y, STRUCTURE_EXTENSION) === OK) {\n                    console.log(`üîã APOCALYPSE Extension at ${pos.x},${pos.y}`);\n                }\n            });\n        }\n    },\n    \n    activateTowers: function(room) {\n        const towers = room.find(FIND_MY_STRUCTURES, {\n            filter: { structureType: STRUCTURE_TOWER }\n        });\n        \n        let enemiesEngaged = 0;\n        \n        towers.forEach(tower => {\n            // APOCALYPSE PRIORITY: Kill enemy healers first, then spawns, then attackers\n            const hostileHealers = tower.room.find(FIND_HOSTILE_CREEPS, {\n                filter: hostile => hostile.getActiveBodyparts(HEAL) > 0\n            });\n            \n            if (hostileHealers.length > 0) {\n                const target = tower.pos.findClosestByRange(hostileHealers);\n                if (target) {\n                    tower.attack(target);\n                    console.log(`üí• APOCALYPSE Tower EXECUTING healer!`);\n                    enemiesEngaged++;\n                    return;\n                }\n            }\n            \n            // Target enemy spawns\n            const enemySpawns = tower.room.find(FIND_HOSTILE_SPAWNS);\n            if (enemySpawns.length > 0) {\n                const target = tower.pos.findClosestByRange(enemySpawns);\n                if (target) {\n                    tower.attack(target);\n                    console.log(`üè¥‚Äç‚ò†Ô∏è APOCALYPSE Tower DESTROYING enemy spawn!`);\n                    enemiesEngaged++;\n                    return;\n                }\n            }\n            \n            // Then kill attackers\n            const hostileAttackers = tower.room.find(FIND_HOSTILE_CREEPS, {\n                filter: hostile => {\n                    return hostile.getActiveBodyparts(ATTACK) > 0 || hostile.getActiveBodyparts(RANGED_ATTACK) > 0;\n                }\n            });\n            \n            if (hostileAttackers.length > 0) {\n                const target = tower.pos.findClosestByRange(hostileAttackers);\n                if (target) {\n                    tower.attack(target);\n                    console.log(`‚öîÔ∏è APOCALYPSE Tower OBLITERATING hostile!`);\n                    enemiesEngaged++;\n                    return;\n                }\n            }\n            \n            // Finally attack any hostile\n            const closestHostile = tower.pos.findClosestByRange(FIND_HOSTILE_CREEPS);\n            if (closestHostile) {\n                tower.attack(closestHostile);\n                    console.log(`‚öîÔ∏è APOCALYPSE Tower ANNIHILATING hostile`);\n                enemiesEngaged++;\n                return;\n            }\n            \n            // Heal damaged allies\n            const damagedAlly = tower.pos.findClosestByRange(FIND_MY_CREEPS, {\n                filter: creep => creep.hits < creep.hitsMax * 0.8\n            });\n            \n            if (damagedAlly) {\n                tower.heal(damagedAlly);\n                console.log(`üíö APOCALYPSE Tower MENDING ally`);\n            }\n        });\n        \n        return enemiesEngaged;\n    }\n};\n\n// APOCALYPSE military tactics - Total enemy annihilation\nconst military = {\n    scoutEnemy: function(creep) {\n        const enemyRooms = ['W1N1', 'W1N2', 'W1N4', 'W1N5', 'W2N1', 'W2N2', 'W2N3', 'W0N1', 'W0N2', 'W0N3', 'W3N1', 'W3N2', 'W3N3'];\n        const targetRoom = enemyRooms[Math.floor(Math.random() * enemyRooms.length)];\n        \n        if (creep.room.name !== targetRoom) {\n            creep.moveTo(new RoomPosition(25, 25, targetRoom), {visualizePathStyle: {stroke: '#00ff00'}});\n            return;\n        }\n        \n        // Scout for enemies with detailed intelligence\n        const hostiles = creep.room.find(FIND_HOSTILE_CREEPS);\n        const enemyStructures = creep.room.find(FIND_HOSTILE_STRUCTURES);\n        \n        if (hostiles.length > 0 || enemyStructures.length > 0) {\n            gameState.enemyRooms.add(creep.room.name);\n            console.log(`üéØ APOCALYPSE SCOUT Enemy detected in ${creep.room.name}!`);\n            \n            // Detailed enemy analysis\n            const enemySpawns = enemyStructures.filter(s => s.structureType === STRUCTURE_SPAWN);\n            const enemyTowers = enemyStructures.filter(s => s.structureType === STRUCTURE_TOWER);\n            const dangerousCreeps = hostiles.filter(c => c.getActiveBodyparts(ATTACK) > 0 || c.getActiveBodyparts(RANGED_ATTACK) > 0);\n            \n            console.log(`üìä Enemy intel: ${enemySpawns.length} spawns, ${enemyTowers.length} towers, ${dangerousCreeps.length} dangerous creeps`);\n            \n            // Prioritize high-value targets\n            if (enemySpawns.length > 0) {\n                gameState.attackTargets.push({\n                    room: creep.room.name,\n                    type: 'spawn',\n                    pos: enemySpawns[0].pos,\n                    priority: 1,\n                    danger: enemyTowers.length + dangerousCreeps.length\n                });\n            } else if (enemyTowers.length > 0) {\n                gameState.attackTargets.push({\n                    room: creep.room.name,\n                    type: 'tower',\n                    pos: enemyTowers[0].pos,\n                    priority: 2,\n                    danger: dangerousCreeps.length\n                });\n            }\n        }\n        \n        // Keep moving to avoid being hit\n        creep.moveTo(new RoomPosition(Math.random() * 40 + 10, Math.random() * 40 + 10, creep.room.name));\n    },\n    \n    launchApocalypseAttack: function(targetRoom) {\n        console.log(`üöÄüåã LAUNCHING APOCALYPSE ATTACK ON ${targetRoom}!`);\n        \n        // Get current attack forces with detailed analysis\n        const attackers = Object.keys(Game.creeps).filter(name => {\n            const creep = Game.creeps[name];\n            return (creep.memory.role === 'attacker' || creep.memory.role === 'kamikaze' || creep.memory.role === 'apocalypse') && \n                   creep.room.name === gameState.roomName;\n        }).length;\n        \n        const healers = Object.keys(Game.creeps).filter(name => {\n            const creep = Game.creeps[name];\n            return creep.memory.role === 'healer' && creep.room.name === gameState.roomName;\n        }).length;\n        \n        const warriors = Object.keys(Game.creeps).filter(name => {\n            const creep = Game.creeps[name];\n            return creep.memory.role === 'warrior' && creep.room.name === gameState.roomName;\n        }).length;\n        \n        const archers = Object.keys(Game.creeps).filter(name => {\n            const creep = Game.creeps[name];\n            return creep.memory.role === 'archer' && creep.room.name === gameState.roomName;\n        }).length;\n        \n        console.log(`üìä APOCALYPSE forces: ${attackers} attackers, ${healers} healers, ${warriors} warriors, ${archers} archers`);\n        \n        // Launch coordinated attack only if we have sufficient forces\n        const totalAttackPower = attackers + warriors + (archers * 0.8);\n        if (totalAttackPower >= 3) {\n            // Move existing forces to attack\n            Object.keys(Game.creeps).forEach(name => {\n                const creep = Game.creeps[name];\n                if (creep.room.name === gameState.roomName) {\n                    if (creep.memory.role === 'attacker' || creep.memory.role === 'kamikaze' || creep.memory.role === 'apocalypse') {\n                        creep.memory.targetRoom = targetRoom;\n                        creep.memory.mode = 'attack';\n                        console.log(`üéØ ${name} ordered to APOCALYPSE ${targetRoom}`);\n                    }\n                    if (creep.memory.role === 'healer') {\n                        creep.memory.targetRoom = targetRoom;\n                        creep.memory.mode = 'support';\n                        console.log(`üíö ${name} ordered to support APOCALYPSE on ${targetRoom}`);\n                    }\n                    if (creep.memory.role === 'warrior' || creep.memory.role === 'archer') {\n                        creep.memory.targetRoom = targetRoom;\n                        creep.memory.mode = 'assault';\n                        console.log(`‚öîÔ∏è ${name} ordered to assault ${targetRoom}`);\n                    }\n                }\n            });\n            \n            gameState.lastAttackTime = Game.time;\n            gameState.attackWaveSize = totalAttackPower;\n            gameState.totalWarDeclared = true;\n        } else {\n            console.log(`‚è≥ Insufficient forces for APOCALYPSE attack. Need more units.`);\n        }\n    }\n};\n\n// Role execution functions - Enhanced for APOCALYPSE\nconst roleFunctions = {\n    harvester: function(creep) {\n        if (creep.store.getFreeCapacity() > 0) {\n            const sources = creep.room.find(FIND_SOURCES);\n            if (sources.length > 0) {\n                if (creep.harvest(sources[0]) === ERR_NOT_IN_RANGE) {\n                    creep.moveTo(sources[0], {visualizePathStyle: {stroke: '#ffaa00'}});\n                }\n            }\n        } else {\n            const targets = creep.room.find(FIND_STRUCTURES, {\n                filter: (structure) => {\n                    return (structure.structureType === STRUCTURE_EXTENSION ||\n                            structure.structureType === STRUCTURE_SPAWN ||\n                            structure.structureType === STRUCTURE_TOWER) &&\n                            structure.store.getFreeCapacity(RESOURCE_ENERGY) > 0;\n                }\n            });\n            if (targets.length > 0) {\n                if (creep.transfer(targets[0], RESOURCE_ENERGY) === ERR_NOT_IN_RANGE) {\n                    creep.moveTo(targets[0], {visualizePathStyle: {stroke: '#ffffff'}});\n                }\n            }\n        }\n    },\n    \n    upgrader: function(creep) {\n        if (creep.store[RESOURCE_ENERGY] === 0) {\n            const sources = creep.room.find(FIND_SOURCES);\n            if (sources.length > 0) {\n                if (creep.harvest(sources[0]) === ERR_NOT_IN_RANGE) {\n                    creep.moveTo(sources[0], {visualizePathStyle: {stroke: '#ffaa00'}});\n                }\n            }\n        } else {\n            if (creep.upgradeController(creep.room.controller) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(creep.room.controller, {visualizePathStyle: {stroke: '#ffffff'}});\n            }\n        }\n    },\n    \n    builder: function(creep) {\n        const targets = creep.room.find(FIND_CONSTRUCTION_SITES);\n        if (targets.length) {\n            if (creep.store[RESOURCE_ENERGY] === 0) {\n                const sources = creep.room.find(FIND_SOURCES);\n                if (sources.length > 0) {\n                    if (creep.harvest(sources[0]) === ERR_NOT_IN_RANGE) {\n                        creep.moveTo(sources[0], {visualizePathStyle: {stroke: '#ffaa00'}});\n                    }\n                }\n            } else {\n                if (creep.build(targets[0]) === ERR_NOT_IN_RANGE) {\n                    creep.moveTo(targets[0], {visualizePathStyle: {stroke: '#ffffff'}});\n                }\n            }\n        } else {\n            roleFunctions.upgrader(creep);\n        }\n    },\n    \n    repairer: function(creep) {\n        const targets = creep.room.find(FIND_STRUCTURES, {\n            filter: object => object.hits < object.hitsMax && object.structureType !== STRUCTURE_WALL\n        });\n        \n        targets.sort((a, b) => a.hits - b.hits);\n        \n        if (targets.length > 0) {\n            if (creep.store[RESOURCE_ENERGY] === 0) {\n                const sources = creep.room.find(FIND_SOURCES);\n                if (sources.length > 0) {\n                    if (creep.harvest(sources[0]) === ERR_NOT_IN_RANGE) {\n                        creep.moveTo(sources[0], {visualizePathStyle: {stroke: '#ffaa00'}});\n                    }\n                }\n            } else {\n                if (creep.repair(targets[0]) === ERR_NOT_IN_RANGE) {\n                    creep.moveTo(targets[0], {visualizePathStyle: {stroke: '#ffffff'}});\n                }\n            }\n        } else {\n            roleFunctions.builder(creep);\n        }\n    },\n    \n    scout: function(creep) {\n        military.scoutEnemy(creep);\n    },\n    \n    warrior: function(creep) {\n        if (creep.memory.targetRoom && creep.room.name !== creep.memory.targetRoom) {\n            creep.moveTo(new RoomPosition(25, 25, creep.memory.targetRoom), {visualizePathStyle: {stroke: '#ff0000'}});\n            return;\n        }\n        \n        const hostiles = creep.room.find(FIND_HOSTILE_CREEPS);\n        if (hostiles.length > 0) {\n            const target = creep.pos.findClosestByRange(hostiles);\n            if (creep.attack(target) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(target, {visualizePathStyle: {stroke: '#ff0000'}});\n            }\n        } else {\n            if (creep.memory.mode === 'assault' && creep.memory.targetRoom) {\n                creep.moveTo(new RoomPosition(25, 25, creep.memory.targetRoom), {visualizePathStyle: {stroke: '#ff0000'}});\n            } else {\n                creep.moveTo(new RoomPosition(Math.random() * 40 + 10, Math.random() * 40 + 10, creep.room.name));\n            }\n        }\n    },\n    \n    archer: function(creep) {\n        if (creep.memory.targetRoom && creep.room.name !== creep.memory.targetRoom) {\n            creep.moveTo(new RoomPosition(25, 25, creep.memory.targetRoom), {visualizePathStyle: {stroke: '#ff0000'}});\n            return;\n        }\n        \n        const hostiles = creep.room.find(FIND_HOSTILE_CREEPS);\n        if (hostiles.length > 0) {\n            const target = creep.pos.findClosestByRange(hostiles);\n            if (creep.rangedAttack(target) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(target, {visualizePathStyle: {stroke: '#ff0000'}});\n            } else {\n                if (creep.pos.getRangeTo(target) <= 3) {\n                    creep.rangedMassAttack();\n                }\n            }\n        } else {\n            if (creep.memory.mode === 'assault' && creep.memory.targetRoom) {\n                creep.moveTo(new RoomPosition(25, 25, creep.memory.targetRoom), {visualizePathStyle: {stroke: '#ff0000'}});\n            } else {\n                creep.moveTo(new RoomPosition(Math.random() * 40 + 10, Math.random() * 40 + 10, creep.room.name));\n            }\n        }\n    },\n    \n    healer: function(creep) {\n        if (creep.memory.targetRoom && creep.room.name !== creep.memory.targetRoom && creep.memory.mode === 'support') {\n            creep.moveTo(new RoomPosition(25, 25, creep.memory.targetRoom), {visualizePathStyle: {stroke: '#00ff00'}});\n            return;\n        }\n        \n        // Heal damaged allies first (prioritize military units)\n        const militaryAllies = creep.room.find(FIND_MY_CREEPS, {\n            filter: ally => (ally.memory.role === 'warrior' || ally.memory.role === 'archer' || \n                           ally.memory.role === 'attacker' || ally.memory.role === 'kamikaze' || \n                           ally.memory.role === 'apocalypse') && ally.hits < ally.hitsMax\n        });\n        \n        if (militaryAllies.length > 0) {\n            const target = creep.pos.findClosestByRange(militaryAllies);\n            if (creep.heal(target) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(target, {visualizePathStyle: {stroke: '#00ff00'}});\n            }\n            return;\n        }\n        \n        // Heal any damaged ally\n        const damagedAlly = creep.pos.findClosestByRange(FIND_MY_CREEPS, {\n            filter: ally => ally.hits < ally.hitsMax\n        });\n        \n        if (damagedAlly) {\n            if (creep.heal(damagedAlly) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(damagedAlly, {visualizePathStyle: {stroke: '#00ff00'}});\n            }\n            return;\n        }\n        \n        // Follow military units if no one needs healing\n        const militaryUnits = creep.room.find(FIND_MY_CREEPS, {\n            filter: ally => ['warrior', 'archer', 'attacker', 'kamikaze', 'apocalypse'].includes(ally.memory.role)\n        });\n        \n        if (militaryUnits.length > 0) {\n            const target = creep.pos.findClosestByRange(militaryUnits);\n            if (creep.pos.getRangeTo(target) > 2) {\n                creep.moveTo(target, {visualizePathStyle: {stroke: '#00ff00'}});\n            }\n        }\n    },\n    \n    attacker: function(creep) {\n        // APOCALYPSE ATTACK MODE\n        if (creep.memory.targetRoom && creep.room.name !== creep.memory.targetRoom) {\n            creep.moveTo(new RoomPosition(25, 25, creep.memory.targetRoom), {visualizePathStyle: {stroke: '#ff0000'}});\n            return;\n        }\n        \n        // Target enemy spawns first (HIGHEST PRIORITY - KILL THE ENEMY'S ABILITY TO RESPAWN)\n        const enemySpawn = creep.pos.findClosestByPath(FIND_HOSTILE_SPAWNS);\n        if (enemySpawn) {\n            if (creep.attack(enemySpawn) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(enemySpawn, {visualizePathStyle: {stroke: '#ff0000'}});\n            }\n            console.log(`üíÄ ${creep.name} APOCALYPSE ATTACKING ENEMY SPAWN!`);\n            return;\n        }\n        \n        // Target enemy towers (SILENCE THEIR DEFENSES)\n        const enemyTower = creep.pos.findClosestByPath(FIND_HOSTILE_STRUCTURES, {\n            filter: { structureType: STRUCTURE_TOWER }\n        });\n        if (enemyTower) {\n            if (creep.attack(enemyTower) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(enemyTower, {visualizePathStyle: {stroke: '#ff0000'}});\n            }\n            console.log(`üèóÔ∏è ${creep.name} APOCALYPSE DESTROYING ENEMY TOWER!`);\n            return;\n        }\n        \n        // Target enemy extensions (STARVE THEIR ECONOMY)\n        const enemyExtensions = creep.room.find(FIND_HOSTILE_STRUCTURES, {\n            filter: s => s.structureType === STRUCTURE_EXTENSION\n        });\n        if (enemyExtensions.length > 0) {\n            const target = creep.pos.findClosestByRange(enemyExtensions);\n            if (creep.attack(target) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(target, {visualizePathStyle: {stroke: '#ff0000'}});\n            }\n            console.log(`üî• ${creep.name} APOCALYPSE DESTROYING ENEMY EXTENSIONS!`);\n            return;\n        }\n        \n        // Target enemy storage and containers (LOOT AND DESTROY)\n        const enemyStorage = creep.room.find(FIND_HOSTILE_STRUCTURES, {\n            filter: s => s.structureType === STRUCTURE_STORAGE || s.structureType === STRUCTURE_CONTAINER\n        });\n        if (enemyStorage.length > 0) {\n            const target = creep.pos.findClosestByRange(enemyStorage);\n            if (creep.attack(target) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(target, {visualizePathStyle: {stroke: '#ff0000'}});\n            }\n            console.log(`üí∞ ${creep.name} APOCALYPSE DESTROYING ENEMY STORAGE!`);\n            return;\n        }\n        \n        // Kill enemy healers first (REMOVE THEIR SUPPORT)\n        const enemyHealers = creep.room.find(FIND_HOSTILE_CREEPS, {\n            filter: hostile => hostile.getActiveBodyparts(HEAL) > 0\n        });\n        if (enemyHealers.length > 0) {\n            const target = creep.pos.findClosestByRange(enemyHealers);\n            if (creep.attack(target) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(target, {visualizePathStyle: {stroke: '#aa0000'}});\n            }\n            console.log(`ü©π ${creep.name} APOCALYPSE KILLING ENEMY HEALERS!`);\n            return;\n        }\n        \n        // Kill enemy attackers (ELIMINATE THEIR OFFENSE)\n        const enemyAttackers = creep.room.find(FIND_HOSTILE_CREEPS, {\n            filter: hostile => hostile.getActiveBodyparts(ATTACK) > 0 || hostile.getActiveBodyparts(RANGED_ATTACK) > 0\n        });\n        if (enemyAttackers.length > 0) {\n            const target = creep.pos.findClosestByRange(enemyAttackers);\n            if (creep.attack(target) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(target, {visualizePathStyle: {stroke: '#aa0000'}});\n            }\n            console.log(`‚öîÔ∏è ${creep.name} APOCALYPSE KILLING ENEMY ATTACKERS!`);\n            return;\n        }\n        \n        // Attack anything else that moves\n        const anyEnemy = creep.pos.findClosestByPath(FIND_HOSTILE_CREEPS);\n        if (anyEnemy) {\n            if (creep.attack(anyEnemy) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(anyEnemy, {visualizePathStyle: {stroke: '#aa0000'}});\n            }\n            console.log(`üí• ${creep.name} APOCALYPSE ATTACKING ANY ENEMY!`);\n        }\n    },\n    \n    kamikaze: function(creep) {\n        // PURE SUICIDE ANNIHILATION - No retreat, no surrender, only destruction\n        if (creep.memory.targetRoom && creep.room.name !== creep.memory.targetRoom) {\n            creep.moveTo(new RoomPosition(25, 25, creep.memory.targetRoom), {visualizePathStyle: {stroke: '#ff0000'}});\n            return;\n        }\n        \n        // Find highest value target with ruthless efficiency\n        const targets = [\n            ...creep.room.find(FIND_HOSTILE_SPAWNS),                    // Priority 1: Kill their respawn\n            ...creep.room.find(FIND_HOSTILE_STRUCTURES, {filter: {structureType: STRUCTURE_TOWER}}), // Priority 2: Silence defenses\n            ...creep.room.find(FIND_HOSTILE_CREEPS, {filter: c => c.getActiveBodyparts(HEAL) > 0}),   // Priority 3: Remove support\n            ...creep.room.find(FIND_HOSTILE_CREEPS, {filter: c => c.getActiveBodyparts(ATTACK) > 0 || c.getActiveBodyparts(RANGED_ATTACK) > 0}), // Priority 4: Kill offense\n            ...creep.room.find(FIND_HOSTILE_STRUCTURES, {filter: s => s.structureType === STRUCTURE_EXTENSION}), // Priority 5: Starve economy\n            ...creep.room.find(FIND_HOSTILE_STRUCTURES, {filter: s => s.structureType === STRUCTURE_STORAGE || s.structureType === STRUCTURE_CONTAINER}), // Priority 6: Loot & destroy\n            ...creep.room.find(FIND_HOSTILE_CREEPS)                      // Priority 7: Kill anything that moves\n        ];\n        \n        if (targets.length > 0) {\n            const target = creep.pos.findClosestByRange(targets);\n            if (creep.attack(target) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(target, {visualizePathStyle: {stroke: '#ff0000'}});\n            }\n            const targetType = target.structureType || 'CREEP';\n            console.log(`üíÄüí• KAMIKAZE ${creep.name} ANNIHILATING ${targetType}! ACCEPT DEATH!`);\n        } else {\n            // No targets? Move to center and wait for death\n            creep.moveTo(new RoomPosition(25, 25, creep.room.name));\n            console.log(`üíÄ KAMIKAZE ${creep.name} AWAITING DEATH IN ENEMY TERRITORY`);\n        }\n    },\n    \n    apocalypse: function(creep) {\n        // ULTIMATE WAR MACHINE - The harbinger of total destruction\n        if (creep.memory.targetRoom && creep.room.name !== creep.memory.targetRoom) {\n            creep.moveTo(new RoomPosition(25, 25, creep.memory.targetRoom), {visualizePathStyle: {stroke: '#ff0000'}});\n            return;\n        }\n        \n        // Multi-role combat: Attack with melee, ranged, and heal self\n        const enemySpawn = creep.pos.findClosestByPath(FIND_HOSTILE_SPAWNS);\n        if (enemySpawn) {\n            if (creep.attack(enemySpawn) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(enemySpawn, {visualizePathStyle: {stroke: '#ff0000'}});\n            } else {\n                // Use ranged attack if in range\n                if (creep.pos.getRangeTo(enemySpawn) <= 3) {\n                    creep.rangedAttack(enemySpawn);\n                }\n                // Heal self if damaged\n                if (creep.hits < creep.hitsMax) {\n                    creep.heal(creep);\n                }\n            }\n            console.log(`üåã APOCALYPSE ${creep.name} DESTROYING ENEMY SPAWN WITH ULTIMATE FORCE!`);\n            return;\n        }\n        \n        // Target enemy towers\n        const enemyTower = creep.pos.findClosestByPath(FIND_HOSTILE_STRUCTURES, {\n            filter: { structureType: STRUCTURE_TOWER }\n        });\n        if (enemyTower) {\n            if (creep.attack(enemyTower) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(enemyTower, {visualizePathStyle: {stroke: '#ff0000'}});\n            } else {\n                if (creep.pos.getRangeTo(enemyTower) <= 3) {\n                    creep.rangedAttack(enemyTower);\n                }\n                if (creep.hits < creep.hitsMax) {\n                    creep.heal(creep);\n                }\n            }\n            console.log(`üèóÔ∏è APOCALYPSE ${creep.name} DEMOLISHING ENEMY TOWER WITH ULTIMATE FORCE!`);\n            return;\n        }\n        \n        // Mass attack enemy creeps\n        const hostiles = creep.room.find(FIND_HOSTILE_CREEPS);\n        if (hostiles.length > 0) {\n            const target = creep.pos.findClosestByRange(hostiles);\n            if (creep.attack(target) === ERR_NOT_IN_RANGE) {\n                creep.moveTo(target, {visualizePathStyle: {stroke: '#ff0000'}});\n            } else {\n                // Use ranged mass attack if multiple enemies nearby\n                if (hostiles.length > 2 && creep.pos.getRangeTo(target) <= 3) {\n                    creep.rangedMassAttack();\n                } else {\n                    creep.rangedAttack(target);\n                }\n                // Heal self while fighting\n                if (creep.hits < creep.hitsMax) {\n                    creep.heal(creep);\n                }\n            }\n            console.log(`‚öîÔ∏è APOCALYPSE ${creep.name} OBLITERATING ENEMY CREEPS WITH ULTIMATE FORCE!`);\n            return;\n        }\n        \n        // Heal self if no enemies and damaged\n        if (creep.hits < creep.hitsMax) {\n            creep.heal(creep);\n        }\n    }\n};\n\n// Spawn management - Enhanced for APOCALYPSE\nconst spawnManager = {\n    spawnCreep: function(spawn, role) {\n        const roleConfig = roles[role];\n        if (!roleConfig) return null;\n        \n        const body = roleConfig.body;\n        const name = `${role}_${Game.time}_${Math.floor(Math.random() * 10000)}`;\n        \n        const result = spawn.spawnCreep(body, name, {\n            memory: {\n                role: role,\n                born: Game.time,\n                homeRoom: spawn.room.name,\n                veteran: false\n            }\n        });\n        \n        if (result === OK) {\n            console.log(`üÜï APOCALYPSE Spawned ${role}: ${name}`);\n            return name;\n        }\n        \n        return null;\n    },\n    \n    manageSpawning: function(spawn) {\n        if (spawn.spawning) return;\n        \n        const room = spawn.room;\n        const currentCreeps = Object.keys(Game.creeps);\n        \n        // Count creeps by role\n        const creepCounts = {};\n        const roomCreeps = {};\n        currentCreeps.forEach(name => {\n            const creep = Game.creeps[name];\n            if (creep.memory.role) {\n                creepCounts[creep.memory.role] = (creepCounts[creep.memory.role] || 0) + 1;\n                if (creep.room.name === room.name) {\n                    roomCreeps[creep.memory.role] = (roomCreeps[creep.memory.role] || 0) + 1;\n                }\n            }\n        });\n        \n        // APOCALYPSE spawning strategy based on defense mode\n        if (gameState.defenseMode === DEFENSE_MODE.APOCALYPSE) {\n            // Maximum military production - no mercy\n            if (roomCreeps.apocalypse < 2) {\n                spawnManager.spawnCreep(spawn, 'apocalypse');\n                return;\n            }\n            if (roomCreeps.kamikaze < 3) {\n                spawnManager.spawnCreep(spawn, 'kamikaze');\n                return;\n            }\n            if (roomCreeps.attacker < 4) {\n                spawnManager.spawnCreep(spawn, 'attacker');\n                return;\n            }\n            if (roomCreeps.warrior < 3) {\n                spawnManager.spawnCreep(spawn, 'warrior');\n                return;\n            }\n            if (roomCreeps.archer < 3) {\n                spawnManager.spawnCreep(spawn, 'archer');\n                return;\n            }\n            if (roomCreeps.healer < 2) {\n                spawnManager.spawnCreep(spawn, 'healer');\n                return;\n            }\n        }\n        \n        if (gameState.defenseMode === DEFENSE_MODE.TOTAL_WAR || gameState.defenseMode === DEFENSE_MODE.EMERGENCY) {\n            // Emergency military production\n            if (roomCreeps.warrior < 3) {\n                spawnManager.spawnCreep(spawn, 'warrior');\n                return;\n            }\n            if (roomCreeps.kamikaze < 2) {\n                spawnManager.spawnCreep(spawn, 'kamikaze');\n                return;\n            }\n            if (roomCreeps.archer < 3) {\n                spawnManager.spawnCreep(spawn, 'archer');\n                return;\n            }\n            if (roomCreeps.healer < 2) {\n                spawnManager.spawnCreep(spawn, 'healer');\n                return;\n            }\n            if (roomCreeps.attacker < 3) {\n                spawnManager.spawnCreep(spawn, 'attacker');\n                return;\n            }\n        }\n        \n        // Economy phase management\n        const energyAvailable = room.energyAvailable;\n        const energyCapacity = room.energyCapacityAvailable;\n        \n        if (energyAvailable < energyCapacity * 0.3) {\n            gameState.economyPhase = 'critical';\n        } else if (energyAvailable < energyCapacity * 0.7) {\n            gameState.economyPhase = 'developing';\n        } else {\n            gameState.economyPhase = 'strong';\n        }\n        \n        // Normal spawning priorities with economy consideration\n        for (const role in roles) {\n            const roleConfig = roles[role];\n            const currentCount = roomCreeps[role] || 0;\n            \n            let maxCount = roleConfig.maxCount;\n            if (gameState.economyPhase === 'critical') {\n                maxCount = roleConfig.emergencyCount;\n            } else if (gameState.defenseMode >= DEFENSE_MODE.WAR) {\n                maxCount = roleConfig.emergencyCount;\n            }\n            \n            if (currentCount < maxCount) {\n                if (spawnManager.spawnCreep(spawn, role)) {\n                    return;\n                }\n            }\n        }\n    }\n};\n\n// Main game loop - APOCALYPSE EDITION\nmodule.exports.loop = function() {\n    // Update game state\n    gameState.currentTick = Game.time;\n    \n    // Clear dead creeps from memory\n    for (const name in Memory.creeps) {\n        if (!Game.creeps[name]) {\n            delete Memory.creeps[name];\n            console.log(`üíÄ APOCALYPSE Cleared dead creep: ${name}`);\n        }\n    }\n    \n    // Get current room\n    const room = Game.rooms[gameState.roomName];\n    if (!room) {\n        console.log(`‚ùå APOCALYPSE Room ${gameState.roomName} not found!`);\n        return;\n    }\n    \n    // Find enemies in room\n    gameState.enemies = room.find(FIND_HOSTILE_CREEPS);\n    \n    // Update defense mode based on threat level\n    if (gameState.enemies.length > 0) {\n        gameState.lastEnemySeen = Game.time;\n        \n        // Determine threat level with enhanced analysis\n        const dangerousEnemies = gameState.enemies.filter(e => \n            e.getActiveBodyparts(ATTACK) > 0 || e.getActiveBodyparts(RANGED_ATTACK) > 0\n        ).length;\n        \n        const totalEnemyParts = gameState.enemies.reduce((sum, enemy) => sum + enemy.body.length, 0);\n        const enemySpawns = room.find(FIND_HOSTILE_SPAWNS);\n        const enemyTowers = room.find(FIND_HOSTILE_STRUCTURES, {\n            filter: { structureType: STRUCTURE_TOWER }\n        });\n        \n        if (dangerousEnemies >= 5 || totalEnemyParts >= 30 || enemySpawns.length > 0 || enemyTowers.length > 0) {\n            gameState.defenseMode = DEFENSE_MODE.APOCALYPSE;\n            gameState.militaryPhase = 'total_annihilation';\n        } else if (dangerousEnemies >= 3) {\n            gameState.defenseMode = DEFENSE_MODE.TOTAL_WAR;\n            gameState.militaryPhase = 'aggressive_assault';\n        } else if (dangerousEnemies > 0) {\n            gameState.defenseMode = DEFENSE_MODE.WAR;\n            gameState.militaryPhase = 'defensive_counter';\n        } else {\n            gameState.defenseMode = DEFENSE_MODE.ALERT;\n            gameState.militaryPhase = 'patrol';\n        }\n    } else {\n        // Gradually decrease alert level\n        const timeSinceEnemy = Game.time - gameState.lastEnemySeen;\n        if (timeSinceEnemy > 150) {\n            gameState.defenseMode = DEFENSE_MODE.PEACETIME;\n            gameState.militaryPhase = 'defensive';\n        } else if (timeSinceEnemy > 100) {\n            gameState.defenseMode = DEFENSE_MODE.ALERT;\n            gameState.militaryPhase = 'patrol';\n        } else if (timeSinceEnemy > 50) {\n            gameState.defenseMode = DEFENSE_MODE.WAR;\n            gameState.militaryPhase = 'defensive_counter';\n        }\n    }\n    \n    // Build defenses\n    if (Game.time % 10 === 0) {\n        defense.buildFortress(room);\n        defense.buildTowers(room);\n        defense.buildExtensions(room);\n    }\n    \n    // Activate towers\n    const towersEngaged = defense.activateTowers(room);\n    \n    // Manage spawning\n    const spawn = Game.spawns.Spawn1;\n    if (spawn) {\n        spawnManager.manageSpawning(spawn);\n    }\n    \n    // Execute creep roles\n    for (const name in Game.creeps) {\n        const creep = Game.creeps[name];\n        if (creep.spawning) continue;\n        \n        const role = creep.memory.role;\n        if (roleFunctions[role]) {\n            try {\n                roleFunctions[role](creep);\n            } catch (error) {\n                console.log(`‚ùå APOCALYPSE Error in ${role} ${name}: ${error}`);\n            }\n        }\n    }\n    \n    // APOCALYPSE ATTACK STRATEGY - Enhanced intelligence\n    if (Game.time % 30 === 0 && gameState.defenseMode >= DEFENSE_MODE.WAR) {\n        const targetRooms = Array.from(gameState.enemyRooms);\n        if (targetRooms.length > 0) {\n            // Pick highest priority target based on danger assessment\n            let targetRoom = targetRooms[0];\n            if (gameState.attackTargets.length > 0) {\n                gameState.attackTargets.sort((a, b) => a.priority - b.priority);\n                targetRoom = gameState.attackTargets[0].room;\n            }\n            military.launchApocalypseAttack(targetRoom);\n        }\n    }\n    \n    // Launch periodic attacks even without scouting - be proactive\n    if (Game.time % 150 === 0 && Game.time - gameState.lastAttackTime > 100) {\n        const potentialTargets = ['W1N1', 'W1N2', 'W1N4', 'W1N5', 'W2N1', 'W2N2', 'W3N1', 'W3N2'];\n        const targetRoom = potentialTargets[Math.floor(Math.random() * potentialTargets.length)];\n        military.launchApocalypseAttack(targetRoom);\n    }\n    \n    // APOCALYPSE escalation - if we haven't found enemies, expand search\n    if (Game.time % 500 === 0 && gameState.enemyRooms.size === 0 && !gameState.totalWarDeclared) {\n        console.log(`üåç APOCALYPSE Expanding search for enemies...`);\n        // Add more rooms to scout list\n        const expansionRooms = ['W4N1', 'W4N2', 'W4N3', 'W5N1', 'W5N2', 'W6N1', 'W6N2', 'W7N1', 'W8N1', 'W9N1'];\n        expansionRooms.forEach(room => {\n            // Will be picked up by scouts in their random selection\n        });\n    }\n    \n    // Status report - APOCALYPSE style\n    if (Game.time % 10 === 0) {\n        const modeNames = ['PEACETIME', 'ALERT', 'WAR', 'EMERGENCY', 'TOTAL_WAR', 'APOCALYPSE'];\n        const enemyRooms = Array.from(gameState.enemyRooms).join(', ') || 'None';\n        const attackersReady = Object.keys(Game.creeps).filter(name => {\n            const creep = Game.creeps[name];\n            return (creep.memory.role === 'attacker' || creep.memory.role === 'kamikaze' || creep.memory.role === 'apocalypse') && \n                   creep.room.name === gameState.roomName;\n        }).length;\n        \n        const militaryPhase = gameState.militaryPhase.toUpperCase();\n        const economyPhase = gameState.economyPhase.toUpperCase();\n        \n        console.log(`üåã APOCALYPSE AI: ${modeNames[gameState.defenseMode]} | Phase: ${militaryPhase} | Economy: ${economyPhase} | Energy: ${room.energyAvailable}/${room.energyCapacityAvailable} | Creeps: ${Object.keys(Game.creeps).length} | Enemies: ${gameState.enemies.length} | Attackers: ${attackersReady} | Enemy Rooms: ${enemyRooms}`);\n        \n        // Special APOCALYPSE warnings\n        if (gameState.defenseMode === DEFENSE_MODE.APOCALYPSE) {\n            console.log(`üî•üî•üî• TOTAL ANNIHILATION MODE ACTIVE - NO MERCY FOR THE ENEMY! üî•üî•üî•`);\n        }\n    }\n};"}}